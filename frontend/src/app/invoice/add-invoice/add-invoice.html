
<div class="invoice-page">
  <button [routerLink]="['/invoices']" class="btn back">Back</button>
  <!-- Page Header -->
  <div class="page-header">
    <h1>Add Invoice</h1>
    <p class="subtitle">Create and manage invoices efficiently</p>
  </div>

  <div class="invoice-container">

    <!-- Left: Customer Info -->
    <div class="card customer-card">
      <h2>Customer Details</h2>

      <div class="form-group">
        <label>Name</label>
        <input placeholder="Enter Customer Name" [(ngModel)]="invoice.name">
      </div>

      <div class="form-group">
        <label>College</label>
        <input placeholder="College Name" [(ngModel)]="invoice.college">
      </div>

      <div class="form-group">
        <label>Year</label>
        <input placeholder="Year" [(ngModel)]="invoice.year">
      </div>

      <div class="form-group">
        <label>Email</label>
        <input placeholder="Customer Email" [(ngModel)]="invoice.email" type="email">
      </div>

      <div class="form-group">
        <label>Phone</label>
        <input placeholder="Phone Number" [(ngModel)]="invoice.phone">
      </div>

      <div class="form-group">
        <label>Status</label>
        <select [(ngModel)]="invoice.status">
          <option *ngFor="let s of statuses">{{ s }}</option>
        </select>
      </div>
    </div>

    <!-- Right: Scanner & Products -->
    <div class="card products-card">

      <!-- Scanner Mode Switch -->
      <h2>Scanner Mode</h2>
      <div class="scanner-mode">
        <label>
          <input type="radio" name="scannerMode" value="hardware"
                 [(ngModel)]="scannerMode"> Hardware / Manual
        </label>
        <label>
          <input type="radio" name="scannerMode" value="camera"
                 [(ngModel)]="scannerMode"> Camera
        </label>
      </div>

      <!-- Hardware / Manual Input -->
      <div *ngIf="scannerMode === 'hardware'" class="barcode-input">
        <label>Scan or Enter Barcode:</label>
        <input type="text"
               [(ngModel)]="barcodeValue"
               (keyup.enter)="handleBarcode(barcodeValue)"
               placeholder="Scan barcode with reader or type manually"
               #barcodeInput />
      </div>

      <!-- Camera Scanner -->
      <div *ngIf="scannerMode === 'camera'" class="scanner-wrapper">
        <button class="btn" (click)="toggleScanner()">
          {{ scannerEnabled ? 'Stop Scanner' : 'Start Scanner' }}
        </button>

        <zxing-scanner
          *ngIf="scannerEnabled"
          [device]="selectedDevice"
          [formats]="formats"
          (scanSuccess)="onBarcodeScanned($event)"
          (camerasFound)="onCamerasFound($event)">
        </zxing-scanner>
      </div>

      <!-- Products List -->
      <h2>Products</h2>
      <div class="products-list" *ngFor="let p of invoice.products; let i = index">
        <div class="product-row">

          <input type="text" placeholder="Product Name" [(ngModel)]="p.itemName" (input)="onProductInput(p)">
          
          <ul *ngIf="p.filteredProducts?.length" class="dropdown">
            <li *ngFor="let prod of p.filteredProducts" (click)="selectProduct(p, prod)">
              {{ prod.itemName }}
            </li>
          </ul>

          <input type="number" [value]="p.stockQty" placeholder="Stock" readonly class="stock-field">
          <input type="text" [value]="p.place" placeholder="Place" readonly class="place-field"> 
          <input type="number" placeholder="Quantity" [(ngModel)]="p.qty" (ngModelChange)="validateQty(p)">
          <input type="number" placeholder="Rate" [(ngModel)]="p.rate">
          <button class="btn remove-btn" (click)="removeProduct(i)">Remove</button>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button class="btn add-btn" (click)="addProduct()">Add Product</button>
        <button class="btn save-btn" (click)="save()">Save Invoice</button>
      </div>

    </div>
  </div>
</div>
